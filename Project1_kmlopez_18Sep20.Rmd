---
title: "Project 1 - Karen Lopez"
date: "September 18, 2020"
output:
  rmarkdown::github_document:
    toc: true
knit: (function(input, ...){
  rmarkdown::render(
    input,
    output_file="README.md",
    envir=globalenv()
  )})
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Reading and Summarizing Data from the NHL's API
This vignette was compiled to provide detailed instructions on reading and summarizing data from the National Hockey League's, or NHL's, API using R code.

## Required Packages
First, install and read in the necessary packages, as shown below. Packages only need to be installed once, but code is included in comment.  
```{r packages, message=FALSE}
#install.packages("tidyverse")
#library(tidyverse)
library(httr)
library(jsonlite)
```

## Contact and Get Data
This code contains functions that will contact the [NHL records API](https://gitlab.com/dword4/nhlapi/-/blob/master/records-api.md) and [NHL stat API](https://gitlab.com/dword4/nhlapi/-/blob/master/stats-api.md), and return parsed, well-formatted data.  
```{r getData, message=FALSE}
#function that creates the url for the records API
getUrl <- function(input){
  baseUrl <- "https://records.nhl.com/site/api/franchise"
  table <- input
  fullURL <- paste0(baseUrl, table) #create url
}

franchise <- function(){
  franchiseAPI <- GET(getUrl(NULL))
  franchiseAPI #check connection
  
  franchiseText <- content(franchiseAPI, "text") #convert to JSON text form
  #franchiseText #check dataset
  franchiseList <- fromJSON(franchiseText, flatten=TRUE) #convert form
  franchiseList #check dataset
  
  #franchiseList2 <- fromJSON(franchiseText, flatten=TRUE, simplifyDataFrame=TRUE)
  #franchiseList2
  #franchiseDF2 <- as.data.frame(franchiseList2) #convert form to df, but adds .data to column names
  #franchiseDF2
  
  return(franchiseList)
}
franchise()
print(knitr::kable(franchise()))

teamTotals <- function(){
  teamAPI <- GET(getUrl("-team-totals"))
  teamAPI #check connection
  
  teamText <- content(teamAPI, "text") #convert to JSON text form
  #teamText #check dataset
  teamList <- fromJSON(teamText, flatten=TRUE) #convert form
  #teamList #check dataset
  
  #gameTypeId = 2 means regular season games, gameTypeId = 3 means post-season games. Type =1 if you ever see that is preseason
  
  return(teamList)
}
#teamTotals()
#print(knitr::kable(teamTotals()))
```
  
It is intended that you can either specify ID or the name. The intention was to map the names the user gives to the IDs and then just use the ID in the URL building. This means you should use a switch() or if else or something to look at the ID input given, determine if it is a number (use ID directly) or convert it from a franchise name to an ID. If you can get it to work another way with the user specifying either input, that is fine too!  
I wrote a function that incorporated filter() & returns data based on user input of the team name. For ex, using the franchise table, if a user inputs name="Tigers" into my function's arguments..

```{r notReady, eval=FALSE, include=FALSE}
seasonRecords <- function(ID){
  seasonAPI <- GET(getUrl("-season-results?cayenneExp=franchiseId=24&sort=seasonId&dir=DESC"))
  seasonAPI #check connection
  
  seasonText <- content(seasonAPI, "text") #convert to JSON text form
  #seasonText #check dataset
  seasonList <- fromJSON(seasonText, flatten=TRUE) #convert form
  #seasonList #check dataset

  #return(parsedData)
}

goalieRecords <- function(ID){
  goalieAPI <- GET(getUrl("-goalie-records?cayenneExp=franchiseId=ID"))
  goalieAPI #check connection
  
  goalieText <- content(goalieAPI, "text") #convert to JSON text form
  #goalieText #check dataset
  goalieList <- fromJSON(goalieText, flatten=TRUE) #convert form
  #goalieList #check dataset

  #return(parsedData)
}

skaterRecords <- function(ID){
  skaterAPI <- GET(getUrl("-skater-records?cayenneExp=franchiseId=ID"))
  skaterAPI #check connection
  
  skaterText <- content(skaterAPI, "text") #convert to JSON text form
  #skaterText #check dataset
  skaterList <- fromJSON(skaterText, flatten=TRUE) #convert form
  #skaterList #check dataset

  #return(parsedData)
}



#from stats API
teams <- function(){}

#8 modifiers list:https://gitlab.com/dword4/nhlapi/-/blob/master/stats-api.md#teams
```

## Wrapper Function

```{r wrapperFcn, eval=FALSE, include=FALSE}
allAccess <- function(fcn, teamID=NULL, ...){
  result <- c(fcn,"()")
  return(result)
  #doesn't work
}
allAccess(franchise)
```

## Exploratory Analysis

```{r exploreAnalysis}
#do a join

#create 2 new variables

#create some contingency tables

#create numerical summaries

#create 5 plots

```
